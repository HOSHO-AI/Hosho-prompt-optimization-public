name: Test Action (On-Demand)
run-name: "Test â€” ${{ inputs.prompt_file || 'test-prompt.md' }}"

on:
  workflow_dispatch:

permissions:
  contents: read
  actions: write

jobs:
  test-on-demand:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Create test prompt
        run: |
          mkdir -p prompts
          cat > prompts/test-prompt.md << 'PROMPT'
          # Role
          You are a customer support agent for a SaaS billing platform.

          # Task
          Given a customer inquiry about their subscription, provide a clear and helpful response.

          # Constraints
          - Always reference the customer's plan name
          - If the question involves a refund, escalate to a human agent
          - Respond in a professional, empathetic tone

          # Output Format
          Respond with:
          1. Greeting acknowledging the issue
          2. Clear answer or next steps
          3. Closing with offer for further help
          PROMPT

      - name: Run Prompt Factor Reviewer
        uses: ./
        with:
          api_key: ${{ secrets.HOSHO_API_KEY }}
          api_url: ${{ secrets.HOSHO_API_URL }}
          prompt_file: prompts/test-prompt.md
